"use strict";
// Рабочее пространство со всеми сохраняемыми данными

var storage = new (function()
{
    var data = {sheets: [
      {name:"Новый лист", items:[]}
      ]};
    this.data = data;
    this.active = data.sheets[0].items;
    this.ctors = {};
    this.name = 'Проект';
    function getId(obj)
    {


    }

    this.getJSON = function()
    {
        for


        return JSON.stringify(data, function(key, value)
        {
        	if((key !== "_" && key[0] === '_') || key[0] === '$') return undefined;
        	if(typeof value === "object" && value.ctor)
        	{
       			var r = {_:value.ctor};
       			for(var x in value) if(value.hasOwnProperty(x) && typeof value[x] !== "function") 
       				r[x] = value[x];
       			var dep = value.dep;
       			for(var x in dep)
       			{
       				var p = dep[x];
       				if(r[p] instanceof Array)
       				{
       					var s = r[p], d = [];
       					for(var y in s) d[y] = getId(s[y]);
       					r[p] = d;
       				}
       				else r[p] = getId(r[p]);
       			}
        		return r;       		
        	}
        	return value;
        });
    }; 
})();

/*function StorageCtl($scope) {
  $scope.sheets = storage.data.sheets;

  $scope.newSheet = function(name)
  {
    storage.data.sheets.push({name: name, items:[]});
  }
  $scope.removeSheet = function(sheet)
  {
    rfa(storage.data.sheets, sheet);
  }
  $scope.isSel = function(sheet)
  {
    return sheet.items === storage.active;
  }
  $scope.select = function(sheet)
  {
    storage.active = sheet.items;
  }

}*/
