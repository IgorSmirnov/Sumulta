var ajax=new function(){function a(){var b=null;if(window.XMLHttpRequest)b=new XMLHttpRequest;else try{b=new ActiveXObject("Msxml2.XMLHTTP")}catch(f){try{b=new ActiveXObject("Microsoft.XMLHTTP")}catch(d){b=null}}return b}function e(b){var f=[],d;for(d in b)f.push(d+"="+encodeURIComponent(b[d]));return f.join("&")}function c(b,f,d){var c=a(),g=d?d.cb:void 0;d&&d.query&&(f+="?"+e(d.query));c.open(b,f,!!g);f=d&&d.contentType||"application/x-www-form-urlencoded";"POST"===b&&c.setRequestHeader("Content-Type",
f);c.onreadystatechange=g?function(){4==c.readyState&&g(c.status,c.responseText)}:void 0;d=d&&d.data||null;"POST"===b&&"application/x-www-form-urlencoded"===f&&(d=e(d));c.send(d);return c.responseText}this.get=function(b,f){return c("GET",b,f)};this.post=function(b,f){return c("POST",b,f)}};function append(a,e){var c=document.createElement(a);(e||document.body).appendChild(c);return c}function byId(a){return document.getElementById(a)}function show(a){document.getElementById(a).hidden=!1}function hide(a){document.getElementById(a).hidden=!0};var api=new function(a){this.getUsers=function(e,c){a.get("/users",{cb:function(b,c){var d=200===b?null:b,a=JSON.parse(c);e(d,a)},query:c})};this.getProjects=function(e,c){a.get("/projects",{cb:function(b,c){var d=200===b?null:b,a=JSON.parse(c);e(d,a)},query:c})};this.getNews=function(e,c){a.get("/news",{cb:function(b,c){var d=200===b?null:b,a=c?JSON.parse(c):{};e(d,a)},query:c})};this.register=function(){var e=byId("reguser").value,c=byId("regpass").value,b=byId("regpass2").value;e&&c&&c===b&&a.post("/auth/register",
{data:{username:e,password:c},cb:function(c,b){var a=JSON.parse(b);switch(a.result){case "registered":location.href="/"+e+"/";break;case "exists":alert("Логин занят");break;case "error":alert(a.message)}}})};this.login=function(e){var c=byId("loguser").value,b=byId("logpass").value;c&&b&&a.post("/auth/login",{data:{username:c,password:b},cb:function(c,b){var a=JSON.parse(b);switch(a.result){case "authorized":e(!0);break;case "error":alert(a.message);e(!1);break;case !1:alert("Неверный логин или пароль"),
e(!1)}}})};this.logout=function(e){a.post("/auth/logout",{cb:function(c,b){var a=JSON.parse(b);switch(a.result){default:case "unauthorized":e(!0);break;case "error":alert(a.message),e(!1)}}})}}(ajax);function pd(a,e){a._der?a._der.push(e):a._der=[e]}function rfa(a,e){for(var c=0,b=0,f=a.length;b<f;b++){var d=a[b];d!==e&&(a[c++]=d)}a.length=c};
